#!/bin/bash

L1_NODE_HTTP_ENDPOINT=${L1_NODE_HTTP_ENDPOINT:-http://172.23.0.2:8545}

# wait until geth service is ready.
until cast chain-id --rpc-url "$L1_NODE_HTTP_ENDPOINT" 2>/dev/null; do
  sleep 1
done

echo "Start deploying taiko contracts on l1 chain..."

export PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
export TAIKO_L2_ADDRESS=0x1670010000000000000000000000000000010001
export L2_SIGNAL_SERVICE=0x1670010000000000000000000000000000010005
export CONTRACT_OWNER=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
export PROVER_SET_ADMIN=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
export TAIKO_TOKEN_PREMINT_RECIPIENT=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
export TAIKO_TOKEN_NAME="Taiko Token Test"
export TAIKO_TOKEN_SYMBOL="TTKOt"
export TIER_PROVIDER="devnet"
export PAUSE_TAIKO_L1="false"
export PAUSE_BRIDGE="false"
export TAIKO_TOKEN=0x0000000000000000000000000000000000000000
export SHARED_ADDRESS_MANAGER=0x0000000000000000000000000000000000000000
export PROPOSER=0x0000000000000000000000000000000000000000
export PROPOSER_ONE=0x0000000000000000000000000000000000000000
export NUM_MIN_MAJORITY_GUARDIANS=7
export NUM_MIN_MINORITY_GUARDIANS=2

export GUARDIAN_PROVERS="0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906,0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65,0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f,0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
export L2_GENESIS_HASH=0x982852b735b5543adb7668de3ec13004f67cfb2e9efdd688b3d41c0fc56a9cba

cd /taiko/taiko-mono/packages/protocol && forge script script/DeployOnL1.s.sol:DeployOnL1 \
  --fork-url "$L1_NODE_HTTP_ENDPOINT" \
  --broadcast \
  --ffi \
  -vvvv \
  --private-key $PRIVATE_KEY \
  --block-gas-limit 100000000

# get contract addresses.
sh /taiko/get_env.sh
